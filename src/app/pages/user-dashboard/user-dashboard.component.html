<div class="container-fluid my-4">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-11">
        <section
          class="grid grid-cols-1 gap-4 gap-x-8 transition-all sm:grid-cols-2 xl:grid-cols-4">
          <div class="flex w-full flex-col gap-1 rounded-xl border p-4 shadow">
            <section class="flex justify-between gap-2">
              <p class="text-sm">Data Entering</p>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-power h-4 w-4 text-destructive animate-pulse text-red-700">
                <path d="M12 2v10"></path>
                <path d="M18.4 6.6a9 9 0 1 1-12.77.04"></path>
              </svg>
            </section>
            <section class="flex flex-col gap-1">
              <h2 class="text-2xl font-semibold">{{ dataEnteringCount }}</h2>
              <p class="text-xs text-gray-500">Project(s) Started</p>
            </section>
          </div>
          <div class="flex w-full flex-col gap-1 rounded-xl border p-4 shadow">
            <section class="flex justify-between gap-2">
              <p class="text-sm">Documentation</p>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-loader h-4 w-4 text-yellow-500 dark:text-yellow-600 animate-spin-3 delay-700">
                <line x1="12" x2="12" y1="2" y2="6"></line>
                <line x1="12" x2="12" y1="18" y2="22"></line>
                <line x1="4.93" x2="7.76" y1="4.93" y2="7.76"></line>
                <line x1="16.24" x2="19.07" y1="16.24" y2="19.07"></line>
                <line x1="2" x2="6" y1="12" y2="12"></line>
                <line x1="18" x2="22" y1="12" y2="12"></line>
                <line x1="4.93" x2="7.76" y1="19.07" y2="16.24"></line>
                <line x1="16.24" x2="19.07" y1="7.76" y2="4.93"></line>
              </svg>
            </section>
            <section class="flex flex-col gap-1">
              <h2 class="text-2xl font-semibold">{{ documentationCount }}</h2>
              <p class="text-xs text-gray-500">Project(s) In-Processing</p>
            </section>
          </div>
          <div class="flex w-full flex-col gap-1 rounded-xl border p-4 shadow">
            <section class="flex justify-between gap-2">
              <p class="text-sm">Final Stage</p>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-check-circle2 h-4 w-4 text-green-500 dark:text-green-600 animate-pulse">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="m9 12 2 2 4-4"></path>
              </svg>
            </section>
            <section class="flex flex-col gap-1">
              <h2 class="text-2xl font-semibold">{{ finalStageCount }}</h2>
              <p class="text-xs text-gray-500">Project(s) in Final Stage</p>
            </section>
          </div>
          <div class="flex w-full flex-col gap-1 rounded-xl border p-4 shadow">
            <section class="flex justify-between gap-2">
              <p class="text-sm">Completed</p>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-check-circle2 h-4 w-4 text-green-500 dark:text-green-600 animate-pulse">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="m9 12 2 2 4-4"></path>
              </svg>
            </section>
            <section class="flex flex-col gap-1">
              <h2 class="text-2xl font-semibold">{{ completedCount }}</h2>
              <p class="text-xs text-gray-500">Project(s) Completed</p>
            </section>
          </div>
        </section>

        <section class="mt-6 font-sans px-0">
          <div dir="ltr" data-orientation="horizontal">
            <div
              role="tablist"
              aria-orientation="horizontal"
              class="h-10 items-center justify-center rounded-md p-1 grid w-full grid-cols-2 sm:mb-0 mb-40"
              [ngClass]="{'bg-gray-800/50': isDarkTheme, 'bg-gray-200': !isDarkTheme}"
              tabindex="0"
              data-orientation="horizontal">
              <button
                *ngIf="!isRestrictedUser"
                type="button"
                role="tab"
                aria-controls="radix-:R1bqla:-content-projects"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all"
                [ngClass]="{
            'bg-white/90 text-gray-900': activeTab === 'project' && !isDarkTheme,
            'bg-gray-600/90 text-white': activeTab === 'project' && isDarkTheme,
            'text-white/90': isDarkTheme && activeTab !== 'project',
            'text-gray-700': !isDarkTheme && activeTab !== 'project'
          }"
                (click)="onHandleTabChange('project')">
                Projects
              </button>
              <button
                *ngIf="!isRestrictedUser"
                type="button"
                role="tab"
                aria-controls="radix-:R1bqla:-content-companies"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all"
                [ngClass]="{
          'bg-white/90 text-gray-900': activeTab === 'company' && !isDarkTheme,
          'bg-gray-600/90 text-white': activeTab === 'company' && isDarkTheme,
          'text-white/90': isDarkTheme && activeTab !== 'company',
          'text-gray-700': !isDarkTheme && activeTab !== 'company'
        }"
                (click)="onHandleTabChange('company')">
                Companies
              </button>
            </div>
            <div
              data-orientation="horizontal"
              role="tabpanel"
              aria-labelledby="radix-:R1bqla:-trigger-projects"
              id="radix-:R1bqla:-content-projects"
              tabindex="0"
              class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 font-sans">
              <div class="d-flex gap-2">
                <a
                  *ngIf="!isRestrictedUser"
                  class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium border bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
                  target="_blank"
                  href="/add-company"
                  [ngClass]="{ hidden: activeTab != 'company' }">
                  + Add New Company
                </a>

                <!-- Hide Add New Project button if user is restricted -->
                <a
                  *ngIf="!isRestrictedUser"
                  (click)="navigateToProjectForm()"
                  class="cursor-pointer inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium border bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                  + Add New Project
                </a>
              </div>
              <div
                class="w-full"
                [ngClass]="{ hidden: activeTab != 'project' }">
                <div data-state="closed">
                  <button
                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-black text-white text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 my-4"
                    type="button"
                    aria-controls="radix-:r1:"
                    aria-expanded="false"
                    data-state="closed">
                    Search<svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-search ml-2">
                      <circle cx="11" cy="11" r="8"></circle>
                      <path d="m21 21-4.3-4.3"></path>
                    </svg>
                  </button>
                  <div
                    data-state="closed"
                    id="radix-:r1:"
                    hidden
                    class="CollapsibleContent"
                    style></div>
                </div>
                <div class="rounded-md border">
                  <div class="relative w-full overflow-auto">
                    <table class="w-full caption-bottom text-sm">
                      <thead class="[&_tr]:border-b">
                        <tr
                          class="border-b transition-colors hover:bg-muted/50">
                          <th
                            class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Status</th>
                          <th
                            class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Company</th>
                          <th
                            class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Project</th>
                          <th
                            class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">Start
                            Date</th>
                          <th
                            class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">Due/Completed
                            Dates</th>
                          <th
                            class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">Published
                            Documents</th>
                          <th
                            class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">Processed
                            By</th>
                          <th
                            class="h-12 px-4 text-center align-middle font-medium text-muted-foreground">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let company of displayedCompanies"
                          class="border-b hover:bg-muted/50">
                          <td class="px-4 py-2">{{
                            getCompanyStatusLabel(company.currentStage) }}</td>
                          <td class="px-4 py-2">{{ company.business_name }}</td>
                          <td class="px-4 py-2">{{ company.project }}</td>
                          <td class="px-4 py-2 text-right">{{ company.startDate
                            | date:'MMM d, y' }}</td>
                          <td class="px-4 py-2 text-right">{{ company.dueEndDate
                            | date:'MMM d, y' }}</td>
                          <td class="px-4 py-2 text-right">{{
                            company.publishedDocuments }}</td>
                          <td class="px-4 py-2 text-right">{{
                            company.proceededBy }}</td>
                          <td class="px-4 py-2 text-center">
                            <button
                              *ngIf="shouldShowResumeButton(company)"
                              (click)="resumeProject(company)"
                              class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium border border-green-500 bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 h-8 px-3 py-1"
                              [ngClass]="{
                                'border-green-400 bg-green-900/20 text-green-400 hover:bg-green-900/30 hover:text-green-300': isDarkTheme
                              }"
                              title="Resume project from stage {{ company.currentStage }}">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="lucide lucide-play mr-1">
                                <polygon points="5,3 19,12 5,21"></polygon>
                              </svg>
                              Resume
                            </button>
                            <span
                              *ngIf="!shouldShowResumeButton(company)"
                              class="text-xs text-gray-400">
                              -
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="flex items-center justify-end space-x-2 py-4">
                  <div class="space-x-2">
                    <button
                      (click)="prevPage()"
                      [disabled]="currentPage === 1"
                      class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3">
                      Previous
                    </button>
                    <span class="text-sm font-medium"> Page {{ currentPage }} of
                      {{ totalPages == 0? 1 : totalPages }} </span>
                    <button
                      (click)="nextPage()"
                      [disabled]="currentPage >= totalPages"
                      class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3">
                      Next
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- companies details  -->
            <div
              data-state="inactive"
              data-orientation="horizontal"
              role="tabpanel"
              aria-labelledby="radix-:R1bqla:-trigger-companies"
              id="radix-:R1bqla:-content-companies"
              tabindex="0"
              class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
              [ngClass]="{ hidden: activeTab != 'company' }">
              <div class="w-full">
                <div data-state="closed">
                  <button
                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-black text-white text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 my-4"
                    type="button"
                    aria-controls="radix-:r1:"
                    aria-expanded="false"
                    data-state="closed">
                    Search<svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-search ml-2">
                      <circle cx="11" cy="11" r="8"></circle>
                      <path d="m21 21-4.3-4.3"></path>
                    </svg>
                  </button>
                  <div
                    data-state="closed"
                    id="radix-:r1:"
                    hidden
                    class="CollapsibleContent"
                    style></div>
                </div>
                <div class="rounded-md border">
                  <div class="relative w-full overflow-auto">
                    <table class="w-full caption-bottom text-sm">
                      <thead class="[&amp;_tr]:border-b">
                        <tr
                          class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                          <th
                            class="h-12 px-4 font-medium text-muted-foreground ">
                            <div
                              class="">
                              Company
                            </div>
                          </th>
                          <th
                            class="h-12 px-4 font-medium text-muted-foreground ">
                            <div class="">Incorporated Date</div>
                          </th>
                          <th
                            class="h-12 px-4 font-medium text-muted-foreground ">
                            <div class="">
                              Next Annual Return Date
                            </div>
                          </th>
                          <th
                            class="h-12 px-4 font-medium text-muted-foreground ">
                            <div class="">Financial Date</div>
                          </th>
                        </tr>
                      </thead>
                      <tbody class="[&_tr:last-child]:border-0 ">
                        <tr
                          *ngFor="let company of displayedCompanies"
                          class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                          <!-- Company Name -->
                          <td class="px-4 py-2">
                            {{ company.business_name || '-' }}
                          </td>

                          <!-- Incorporated Date -->
                          <td class="px-4 py-2">
                            {{ company.incorporate_date | date: 'MMM d, y' }}
                          </td>

                          <!-- Next Annual Return Date (example: 1 year after incorporate_date) -->
                          <td class="px-4 py-2">
                            {{ getNextAnnualReturnDate(company.incorporate_date)
                            | date: 'MMM d, y' }}
                          </td>

                          <!-- Financial Date (example: same as startDate if not defined) -->
                          <td class="px-4 py-2">
                            {{ company.startDate | date: 'MMM d, y' }}
                          </td>
                        </tr>

                        <!-- Optional: if no data -->
                        <tr *ngIf="!displayedCompanies?.length">
                          <td colspan="4"
                            class="text-center py-4 text-gray-400">
                            No companies found.
                          </td>
                        </tr>
                      </tbody>

                    </table>
                  </div>
                </div>
                <div class="flex items-center justify-end space-x-2 py-4">
                  <div class="space-x-2">
                    <button
                      class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"
                      disabled>
                      Previous</button><button
                      class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"
                      disabled>
                      Next
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>